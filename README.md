# Система управления для контроллера rgb ленты
## Схема подключения

### Основные компоненты:
1. Arduino Mega
2. Адресная светодиодная лента (NeoPixel, 60 LED)
3. Датчик DHT11 (температура/влажность)
4. Датчик MQ-135 (CO₂)
5. Датчик температуры LM335
6. LCD дисплей 20x4 (I²C, обычно адрес 0x27)
7. Кнопка
8. NPN транзисторы (1 шт, например BC547)
9. Резисторы: 1 кОм (1 шт)
10. Внешний источник питания 5V (для LED-ленты)

---

### Подключение компонентов:

**1. Светодиодная лента (NeoPixel):**
- DIN → Pin 7 (Arduino)
- VCC → Внешний источник 5V
- GND → Общий GND

**2. Кнопка:**
- Один вывод → Pin 6 (Arduino)
- Другой вывод → GND

**3. Датчик DHT11:**
- VCC → Pin 4 (Arduino)
- DATA → Pin 5 (Arduino)
- GND → GND

**4. LCD дисплей (I²C):**
- VCC → Коллектор транзистора Q1
- GND → GND
- SDA → Pin 20 (Arduino)
- SCL → Pin 21 (Arduino)

**5. Датчик MQ-135:**
- VCC → 5V (Arduino)
- GND → GND
- OUT → Pin A0 (Arduino)

**6. Датчик LM335:**
- V+ → 5V (Arduino)
- Vout → Pin A1 (Arduino)
- GND → GND
- *Добавить резистор 1 кОм между Vout и GND*

**7. Транзистор Q1 (управление LCD):**
- База → Резистор 1 кОм → Pin 3 (Arduino)
- Коллектор → VCC LCD
- Эмиттер → 5V (Arduino)

---

### Сводная таблица подключений:

| Компонент       | Пин Arduino | Подключение                     | Дополнительные компоненты     |
|-----------------|-------------|---------------------------------|-------------------------------|
| NeoPixel DIN    | 7           | Data In ленты                   | -                             |
| Кнопка          | 6           | Один вывод кнопки               | Другой вывод → GND            |
| DHT11 DATA      | 5           | Сигнальный провод датчика       | -                             |
| DHT11 VCC       | 4           | vcc датчика                     | -                             |
| LCD VCC         | -           | Через Q1                        | Управление: Pin 3 → Q1 Base   |
| LCD SDA         | 20          | I²C Data                        | -                             |
| LCD SCL         | 21          | I²C Clock                       | -                             |
| MQ-135 OUT      | A0          | Аналоговый выход датчика        | -                             |
| LM335 Vout      | A1          | Аналоговый выход датчика        | Резистор 1 кОм → GND          |
| Q1 Base         | 3           | Через резистор 1 кОм            | Коллектор → LCD VCC           |

---

### Ключевые особенности и пояснения:


1. **Питание DHT11 от пина Arduino:**
   - Проблема при монтаже: 
     - При длинных проводах падение напряжения может привести к нестабильной работе датчика
     - у меня просто не было нормальных проводов

2. **Калибровка LM335:**
   - Обязательная процедура:
     ```c
     float readStableTemperature() {
       // ... измерения ...
       tempC += 260.7; // Калибровочная константа!
       return tempC;
     }
     ```
   - Как калибровать:
     1. Измерьте реальную температуру эталонным термометром (T_real)
     2. Считайте значение с датчика без калибровки (T_raw)
     3. Рассчитайте калибровочную константу: 
        `const_calib = T_real - T_raw`
     4. Замените значение в коде

3. **Особенности подключения:**
   - Для LED-ленты обязателен внешний источник питания
   - Все GND компонентов соединены в одной точке (звездообразная топология)

4. **Энергосбережение:**
   - Отключение неиспользуемых компонентов экономит немного энергии
   - В моем случае сделано из за отсутствия нормального БП
   - Управляется командами:
     - `dht11_power T/F`
     - `lcd T/F`
     - `lcd_backlight T/F`

---

### Монтажные рекомендации:
1. Для аналоговых датчиков (MQ-135, LM335) используйте экранированные провода
2. Длина проводов к DHT11 не должна превышать 1.5 м
3. Разместите LM335 вдали от источников тепла (процессор, трансформаторы)
4. Для MQ-135 требуется прогрев 24 часа перед точными измерениями
5. Все силовые линии (к ленте) прокладывайте отдельно от сигнальных

---
## Программная часть
1. вначале залить **erase.ino** для очистки EEPROM от мусора и установки значений по умолчанию (открыть последовательный порт на скорости 9600 и ввести Y)
2. поменять количество светодиодов на своё и записать **sketch.ino** 
3. открыть последовательный порт на скорости 9600 и введите **help**

###### Планируется добавление интерфейса на flask для более удобного управления